(function(E,b){typeof exports=="object"&&typeof module<"u"?module.exports=b():typeof define=="function"&&define.amd?define(b):(E=typeof globalThis<"u"?globalThis:E||self,E.panzoom=b())})(this,function(){"use strict";/*!simple-panzoom v1.0.12024年7月Fri Jul 05 2024 11:44:52 GMT+0800 (中国标准时间)制作*/typeof window<"u"&&(window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),typeof window.CustomEvent!="function"&&(window.CustomEvent=function(e,r){r=r||{bubbles:!1,cancelable:!1,detail:null};var s=document.createEvent("CustomEvent");return s.initCustomEvent(e,r.bubbles,r.cancelable,r.detail),s}));function E(t,e){let r=t.length;for(;r--;)if(t[r].pointerId===e.pointerId)return r;return-1}function b(t,e){let r;if(e.touches){r=0;for(const s of e.touches)s.pointerId=r++,b(t,s);return}r=E(t,e),r>-1&&t.splice(r,1),t.push(e)}function dt(t,e){if(e.touches){for(;t.length;)t.pop();return}const r=E(t,e);r>-1&&t.splice(r,1)}function rt(t){t=t.slice(0);let e=t.pop(),r;for(;r=t.pop();)e={clientX:(r.clientX-e.clientX)/2+e.clientX,clientY:(r.clientY-e.clientY)/2+e.clientY};return e}function H(t){if(t.length<2)return 0;const e=t[0],r=t[1];return Math.sqrt(Math.pow(Math.abs(r.clientX-e.clientX),2)+Math.pow(Math.abs(r.clientY-e.clientY),2))}let M={down:"mousedown",move:"mousemove",up:"mouseup mouseleave"};typeof window<"u"&&(typeof window.PointerEvent=="function"?M={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"}:typeof window.TouchEvent=="function"&&(M={down:"touchstart",move:"touchmove",up:"touchend touchcancel"}));function B(t,e,r,s){M[t].split(" ").forEach(h=>{e.addEventListener(h,r,s)})}function V(t,e,r){M[t].split(" ").forEach(s=>{e.removeEventListener(s,r)})}const ut=typeof document<"u"&&!!document.documentMode;let Z;function ft(){return Z||(Z=document.createElement("div").style)}const ot=["webkit","moz","ms"],X={};function q(t){if(X[t])return X[t];const e=ft();if(t in e)return X[t]=t;const r=t[0].toUpperCase()+t.slice(1);let s=ot.length;for(;s--;){const h=`${ot[s]}${r}`;if(h in e)return X[t]=h}}function Y(t,e){return parseFloat(e[q(t)])||0}function z(t,e,r=window.getComputedStyle(t)){const s=e==="border"?"Width":"";return{left:Y(`${e}Left${s}`,r),right:Y(`${e}Right${s}`,r),top:Y(`${e}Top${s}`,r),bottom:Y(`${e}Bottom${s}`,r)}}function P(t,e,r){t.style[q(e)]=r}function ht(t,e){const r=q("transform");P(t,"transition",`${r} ${e.duration}ms ${e.easing}`)}function pt(t,{x:e,y:r,scale:s,isSVG:h},y){if(P(t,"transform",`scale(${s}) translate(${e}px, ${r}px)`),h&&ut){const f=window.getComputedStyle(t).getPropertyValue("transform");t.setAttribute("transform",f)}}function O(t){const e=t.parentNode,r=window.getComputedStyle(t),s=window.getComputedStyle(e),h=t.getBoundingClientRect(),y=e.getBoundingClientRect();return{elem:{style:r,width:h.width,height:h.height,top:h.top,bottom:h.bottom,left:h.left,right:h.right,margin:z(t,"margin",r),border:z(t,"border",r)},parent:{style:s,width:y.width,height:y.height,top:y.top,bottom:y.bottom,left:y.left,right:y.right,padding:z(e,"padding",s),border:z(e,"border",s)}}}function mt(t){let e=t;for(;e&&e.parentNode;){if(e.parentNode===document)return!0;e=e.parentNode instanceof ShadowRoot?e.parentNode.host:e.parentNode}return!1}function gt(t){return(t.getAttribute("class")||"").trim()}function wt(t,e){return t.nodeType===1&&` ${gt(t)} `.indexOf(` ${e} `)>-1}function yt(t,e){for(let r=t;r!=null;r=r.parentNode)if(wt(r,e.excludeClass)||e.exclude.indexOf(r)>-1)return!0;return!1}const bt=/^http:[\w\.\/]+svg$/;function vt(t){return bt.test(t.namespaceURI)&&t.nodeName.toLowerCase()!=="svg"}function xt(t){const e={};for(const r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}const it={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,duration:200,easing:"ease-in-out",exclude:[],excludeClass:"panzoom-exclude",handleStartEvent:t=>{t.preventDefault(),t.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",panOnlyWhenZoomed:!1,pinchAndPan:!1,relative:!1,setTransform:pt,startX:0,startY:0,startScale:1,step:.3,touchAction:"none"};function at(t,e){if(!t)throw new Error("Panzoom requires an element as an argument");if(t.nodeType!==1)throw new Error("Panzoom requires an element with a nodeType of 1");if(!mt(t))throw new Error("Panzoom should be called on elements that have been attached to the DOM");e={...it,...e};const r=vt(t),s=t.parentNode;s.style.overflow=e.overflow,s.style.userSelect="none",s.style.touchAction=e.touchAction,(e.canvas?s:t).style.cursor=e.cursor,t.style.userSelect="none",t.style.touchAction=e.touchAction,P(t,"transformOrigin",typeof e.origin=="string"?e.origin:r?"0 0":"50% 50%");function h(){s.style.overflow="",s.style.userSelect="",s.style.touchAction="",s.style.cursor="",t.style.cursor="",t.style.userSelect="",t.style.touchAction="",P(t,"transformOrigin","")}function y(n={}){for(const i in n)n.hasOwnProperty(i)&&(e[i]=n[i]);(n.hasOwnProperty("cursor")||n.hasOwnProperty("canvas"))&&(s.style.cursor=t.style.cursor="",(e.canvas?s:t).style.cursor=e.cursor),n.hasOwnProperty("overflow")&&(s.style.overflow=n.overflow),n.hasOwnProperty("touchAction")&&(s.style.touchAction=n.touchAction,t.style.touchAction=n.touchAction)}let f=0,p=0,u=1,S=!1;T(e.startScale,{animate:!1,force:!0}),setTimeout(()=>{U(e.startX,e.startY,{animate:!1,force:!0})});function $(n,i,c){if(c.silent)return;const d=new CustomEvent(n,{detail:i});t.dispatchEvent(d)}function F(n,i,c){const d={x:f,y:p,scale:u,isSVG:r,originalEvent:c};return typeof i.animate=="boolean"&&(i.animate?ht(t,i):P(t,"transition","none")),i.setTransform(t,d,i),requestAnimationFrame(()=>{const o=O(t);d.dimsOut=o,$(n,d,i),$("panzoomchange",d,i)}),d}function k(n,i,c,d){const o={...e,...d},l={x:f,y:p,opts:o};if(!o.force&&(o.disablePan||o.panOnlyWhenZoomed&&u===o.startScale))return l;if(n=parseFloat(n),i=parseFloat(i),o.disableXAxis||(l.x=(o.relative?f:0)+n),o.disableYAxis||(l.y=(o.relative?p:0)+i),o.contain){const a=O(t),g=a.elem.width/u,m=a.elem.height/u,A=g*c,C=m*c,v=(A-g)/2,x=(C-m)/2;if(o.contain==="inside"){const j=(-a.elem.margin.left-a.parent.padding.left+v)/c,tt=(a.parent.width-A-a.parent.padding.left-a.elem.margin.left-a.parent.border.left-a.parent.border.right+v)/c;l.x=Math.max(Math.min(l.x,tt),j);const et=(-a.elem.margin.top-a.parent.padding.top+x)/c,nt=(a.parent.height-C-a.parent.padding.top-a.elem.margin.top-a.parent.border.top-a.parent.border.bottom+x)/c;l.y=Math.max(Math.min(l.y,nt),et)}else if(o.contain==="outside"){const j=(-(A-a.parent.width)-a.parent.padding.left-a.parent.border.left-a.parent.border.right+v)/c,tt=(v-a.parent.padding.left)/c;l.x=Math.max(Math.min(l.x,tt),j);const et=(-(C-a.parent.height)-a.parent.padding.top-a.parent.border.top-a.parent.border.bottom+x)/c,nt=(x-a.parent.padding.top)/c;l.y=Math.max(Math.min(l.y,nt),et)}}return o.roundPixels&&(l.x=Math.round(l.x),l.y=Math.round(l.y)),l}function N(n,i){const c={...e,...i},d={scale:u,opts:c};if(!c.force&&c.disableZoom)return d;let o=e.minScale,l=e.maxScale;if(c.contain){const a=O(t),g=a.elem.width/u,m=a.elem.height/u;if(g>1&&m>1){const A=a.parent.width-a.parent.border.left-a.parent.border.right,C=a.parent.height-a.parent.border.top-a.parent.border.bottom,v=A/g,x=C/m;e.contain==="inside"?l=Math.min(l,v,x):e.contain==="outside"&&(o=Math.max(o,v,x))}}return d.scale=Math.min(Math.max(n,o),l),d}function U(n,i,c,d){const o=k(n,i,u,c);return f!==o.x||p!==o.y?(f=o.x,p=o.y,F("panzoompan",o.opts,d)):{x:f,y:p,scale:u,isSVG:r,originalEvent:d}}function T(n,i,c){const d=N(n,i),o=d.opts;if(!o.force&&o.disableZoom)return;n=d.scale;let l=f,a=p;if(o.focal){const m=o.focal;l=(m.x/n-m.x/u+f*n)/n,a=(m.y/n-m.y/u+p*n)/n}const g=k(l,a,n,{relative:!1,force:!0});return f=g.x,p=g.y,u=n,F("panzoomzoom",o,c)}function st(n,i){const c={...e,animate:!0,...i};return T(u*Math.exp((n?1:-1)*c.step),c)}function Et(n){return st(!0,n)}function Pt(n){return st(!1,n)}function G(n,i,c,d){const o=O(t),l={width:o.parent.width-o.parent.padding.left-o.parent.padding.right-o.parent.border.left-o.parent.border.right,height:o.parent.height-o.parent.padding.top-o.parent.padding.bottom-o.parent.border.top-o.parent.border.bottom};let a=i.clientX-o.parent.left-o.parent.padding.left-o.parent.border.left-o.elem.margin.left,g=i.clientY-o.parent.top-o.parent.padding.top-o.parent.border.top-o.elem.margin.top;r||(a-=o.elem.width/u/2,g-=o.elem.height/u/2);const m={x:a/l.width*(l.width*n),y:g/l.height*(l.height*n)};return T(n,{...c,animate:!1,focal:m},d)}function Mt(n,i){n.preventDefault();const c={...e,...i,animate:!1},o=(n.deltaY===0&&n.deltaX?n.deltaX:n.deltaY)<0?1:-1,l=N(u*Math.exp(o*c.step/3),c).scale;return G(l,n,c,n)}function At(n){const i={...e,animate:!0,force:!0,...n};u=N(i.startScale,i).scale;const c=k(i.startX,i.startY,u,i);return f=c.x,p=c.y,F("panzoomreset",i)}let W,I,D,L,ct,R;const w=[];function _(n){if(yt(n.target,e))return;b(w,n),S=!0,e.handleStartEvent(n),W=f,I=p,$("panzoomstart",{x:f,y:p,scale:u,isSVG:r,originalEvent:n},e);const i=rt(w);D=i.clientX,L=i.clientY,ct=u,R=H(w)}function J(n){if(!S||W===void 0||I===void 0||D===void 0||L===void 0)return;b(w,n);const i=rt(w),c=w.length>1;let d=u;if(c){R===0&&(R=H(w));const o=H(w)-R;d=N(o*e.step/80+ct).scale,G(d,i,{animate:!1},n)}(!c||e.pinchAndPan)&&U(W+(i.clientX-D)/d,I+(i.clientY-L)/d,{animate:!1},n)}function K(n){w.length===1&&$("panzoomend",{x:f,y:p,scale:u,isSVG:r,originalEvent:n},e),dt(w,n),S&&(S=!1,W=I=D=L=void 0)}let Q=!1;function lt(){Q||(Q=!0,B("down",e.canvas?s:t,_),B("move",document,J,{passive:!0}),B("up",document,K,{passive:!0}))}function Ct(){Q=!1,V("down",e.canvas?s:t,_),V("move",document,J),V("up",document,K)}return e.noBind||lt(),{bind:lt,destroy:Ct,eventNames:M,getPan:()=>({x:f,y:p}),getScale:()=>u,getOptions:()=>xt(e),handleDown:_,handleMove:J,handleUp:K,pan:U,reset:At,resetStyle:h,setOptions:y,setStyle:(n,i)=>P(t,n,i),zoom:T,zoomIn:Et,zoomOut:Pt,zoomToPoint:G,zoomWithWheel:Mt}}return at.defaultOptions=it,at});
